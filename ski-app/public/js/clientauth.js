"use strict";var Auth=Auth||{};Auth.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),this.$main.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},Auth.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide()},Auth.loggedOutState=function(){$(".loggedOut").show(),$(".loggedIn").hide(),this.login()},Auth.register=function(t){t&&t.preventDefault(),$(".modal-content").html('\n  <form method="post" action="/register">\n    <div class="modal-header">\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n      <h4 class="modal-title">Register</h4>\n    </div>\n    <div class="modal-body">\n      <div class="form-group">\n        <label for="user_username">Username</label>\n        <input class="form-control" type="text" name="user[username]" id="user_username" placeholder="Username">\n      </div>\n      <div class="form-group">\n        <label for="user_email">Email</label>\n        <input class="form-control" type="email" name="user[email]" id="user_email" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <label for="user_password">Password</label>\n        <input class="form-control" type="password" name="user[password]" id="user_password" placeholder="Password">\n      </div>\n      <div class="form-group">\n        <label for="user_passwordConfirmation">Confirm Password</label>\n        <input class="form-control" type="passwordConfirmation" name="user[passwordConfirmation]" id="user_passwordConfirmation" placeholder="Confirm Password">\n      </div>\n    </div>\n    <div class="modal-footer">\n      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n      <button type="submit" class="btn btn-primary" value="Register">Register</button>\n    </div>\n  </form>'),$(".modal").modal("show")},Auth.login=function(t){t&&t.preventDefault(),this.$main.html('\n      <h2 class="loggedOut">Login</h2>\n      <form method="post" action="/login" class="loggedOut">\n      <div class="form-group">\n      <input class="form-control" type="email" name="email" placeholder="Email">\n      </div>\n      <div class="form-group">\n      <input class="form-control" type="password" name="password" placeholder="Password">\n      </div>\n      <input class="btn btn-primary" type="submit" value="Login">\n      </form>\n      ')},Auth.logout=function(t){t&&t.preventDefault(),this.removeToken(),this.loggedOutState()},Auth.handleForm=function(t){t&&t.preventDefault();var e=""+Auth.apiUrl+$(this).attr("action"),o=$(this).attr("method"),n=$(this).serialize();return Auth.ajaxRequest(e,o,n,function(t){t.token&&Auth.setToken(t.token),Auth.loggedInState()})},Auth.ajaxRequest=function(t,e,o,n){return $.ajax({url:t,method:e,data:o,beforeSend:this.setRequestHeader.bind(this)}).done(n).fail(function(t){console.log(t)})},Auth.setRequestHeader=function(t){return t.setRequestHeader("Authorization","Bearer "+this.getToken())},Auth.setToken=function(t){return window.localStorage.setItem("token",t)},Auth.getToken=function(){return window.localStorage.getItem("token")},Auth.removeToken=function(){return window.localStorage.clear()},$(Auth.init.bind(Auth));